<div class="respuestas card p-3">
  <div v-if="!saved">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h5 class="mb-0">Tabla de respuestas</h5>
      <div>
        <button class="btn btn-sm btn-success me-2" @click="addRow">Añadir fila</button>
        <button class="btn btn-sm btn-primary" :disabled="!allValid" @click="guardar">Guardar</button>
      </div>
    </div>

    <div class="card-body p-0 mt-3">
      <div class="table-responsive">
        <table class="table table-bordered table-striped mb-0 align-middle">
          <thead class="table-light">
            <tr>
              <th style="width:120px">Nº pregunta</th>
              <th>Respuesta</th>
              <th style="width:120px">Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr v-for="(r, idx) in rows" :key="r._id">
              <td>
                <input type="number" class="form-control" v-model.number="r.pregunta" @input="markDirty(r,'pregunta')" />
                <div v-if="getError(r,'pregunta').mostrar" class="text-danger small mt-1">{{ getError(r,'pregunta').mensaje }}</div>
              </td>
              <td>
                <input type="text" class="form-control" v-model.trim="r.respuesta" @input="markDirty(r,'respuesta')" />
                <div v-if="getError(r,'respuesta').mostrar" class="text-danger small mt-1">{{ getError(r,'respuesta').mensaje }}</div>
              </td>
              <td class="text-center">
                <button class="btn btn-sm btn-danger" @click="removeRow(idx)">Eliminar</button>
              </td>
            </tr>
            <tr v-if="rows.length === 0">
              <td colspan="3" class="text-center py-4">No hay filas. Hacé click en "Añadir fila" para empezar.</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div v-else>
    <div class="card-header d-flex justify-content-between align-items-center">
      <h5 class="mb-0">Respuestas guardadas</h5>
      <div>
        <button class="btn btn-sm btn-secondary me-2" @click="editar">Editar</button>
        <button class="btn btn-sm btn-info me-2" @click="descargarCSV">Descargar CSV</button>
        <button class="btn btn-sm btn-danger" @click="borrarGuardado">Borrar guardado</button>
      </div>
    </div>
    <div class="card-body p-0 mt-3">
      <div class="table-responsive">
        <table class="table table-bordered table-striped mb-0 align-middle">
          <thead class="table-light">
            <tr>
              <th style="width:120px">Nº pregunta</th>
              <th>Respuesta</th>
            </tr>
          </thead>
          <tbody>
            <tr v-for="(r, idx) in savedRows" :key="idx">
              <td>{{ r.pregunta }}</td>
              <td>{{ r.respuesta }}</td>
            </tr>
            <tr v-if="savedRows.length === 0">
              <td colspan="2" class="text-center py-4">No hay respuestas guardadas.</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
